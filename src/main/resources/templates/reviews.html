<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>

    <th:block th:replace="fragments/base :: baseHead"></th:block>
</head>
<body>
<div id="splash" th:style="'background-image: url(\'' + @{/images/chariot-students-splash-overlay0.3.jpg} + '\');'">
    <th:block th:replace="fragments/navbar :: navbarContent"></th:block>
</div>

<main>
    <h2>RECENT REVIEWS</h2>
    <hr class="yellow">

    <div class="profile-container" id="reviews-container">
    </div>

    <div id="pagination">
    </div>
</main>
<div th:replace="fragments/footer :: footer"></div>

<script>
    let currentPage = 0;
    const pageSize = 2;


    const loadReviews = (page) => {
        fetch(`/api/reviews/all?page=${page}&size=${pageSize}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                displayReviews(data.content);
                displayPagination(data.totalPages, page);
            })
            .catch(error => {
                console.error('Error loading reviews:', error);
            });
    };

    const displayReviews = (reviews) => {
        const container = document.getElementById('reviews-container');
        container.innerHTML = '';

        reviews.forEach(review => {
            const reviewHtml = `
                <div class="profile-container">
                    <h3 class="driver-name">${review.driverFirstName} ${review.driverLastName} - Average Rating: ${calculateAverageRating(review.rating)}</h3><br>
                    <div class="review">
                        <div class="review-details">
                            <span class="stars">${generateStarRating(review.rating)}</span> - ${review.userFirstName}
                        </div>
                        <div class="review-text">
                            ${review.content}
                        </div>
                    </div>
                    <br>
                </div>
            `;
            container.innerHTML += reviewHtml;
        });
    };

    const generateStarRating = (rating) => {
        const fullStars = '★'.repeat(Math.floor(rating));
        const halfStar = (rating % 1) > 0 ? '☆' : '';
        return fullStars + halfStar;
    };

    const calculateAverageRating = (rating) => {
        return '★★★★★'.substring(0, Math.round(rating));
    };

    const displayPagination = (totalPages, currentPage) => {
        const pagination = document.getElementById('pagination');
        pagination.innerHTML = '';

        for (let i = 0; i < totalPages; i++) {
            const button = `
                <button onclick="loadReviews(${i})" ${i === currentPage ? 'disabled' : ''}>${i + 1}</button>
            `;
            pagination.innerHTML += button;
        }
    };
    loadReviews(currentPage);
</script>


<style>

    #pagination button {
        margin-right: 5px;
    }

    #pagination button[disabled] {
        background-color: #ccc;
        cursor: not-allowed;
    }
</style>
</body>
</html>
